<scriptedContentFragments><scriptedContentFragment name="${resource:MediaGalleries_AddMediaGalleryPostComment_Name}" version="6.0.0.1" description="${resource:MediaGalleries_AddMediaGalleryPostComment_Description}" instanceIdentifier="1778c0b8350046e3b2207f098f5cde95" theme="" isCacheable="true" varyCacheByUser="true" showHeaderByDefault="true" cssClass="add-media-gallery-post-comment"><contentScript>
#set ($media = false)
#set ($media = $core_v2_media.Current)
#if (!$media)
	$core_v2_widget.Hide()
#end
#set($gallery = $core_v2_gallery.Current)
#if (!$core_v2_nodePermission.Get('mediagalleries',$gallery.Id,'MediaGallery_CreateComment').IsAllowed)
	$core_v2_widget.Hide()
#end

&lt;div id="$core_v2_widget.UniqueId('successMessage')" class="message success"&gt;
	$core_v2_language.GetResource('CF_Comment_SuccessMessage') &amp;nbsp;
	&lt;a href="#" class="internal-link close-message" title="$core_v2_language.GetResource('Close')"&gt;&lt;span&gt;&lt;/span&gt;$core_v2_language.GetResource('Close')&lt;/a&gt;
&lt;/div&gt;

&lt;div id="$core_v2_widget.UniqueId('moderateMessage')" class="message warning"&gt;
	$core_v2_language.GetResource('CF_Comment_ModeratedMessaage') &amp;nbsp;
	&lt;a href="#" class="internal-link close-message" title="$core_v2_language.GetResource('Close')"&gt;&lt;span&gt;&lt;/span&gt;$core_v2_language.GetResource('Close')&lt;/a&gt;
&lt;/div&gt;

&lt;div id="$core_v2_widget.UniqueId('errorMessage')" class="message error" style="display: none;"&gt;&lt;/div&gt;

&lt;div id="$core_v2_widget.UniqueId('form')"&gt;
	&lt;div class="field-list-header"&gt;&lt;/div&gt;
	&lt;fieldset class="field-list"&gt;
		&lt;legend class="field-list-description"&gt;$core_v2_language.GetResource('MediaGallery_LeaveComment')&lt;/legend&gt;
		&lt;ul class="field-list"&gt;
			&lt;li class="field-item post-body"&gt;
				&lt;span class="field-item-input"&gt;
					&lt;textarea id="$core_v2_widget.UniqueId('body')" rows="3" name="$core_v2_widget.UniqueId('body')" style="resize: none; overflow-y: hidden;"&gt;&lt;/textarea&gt;
				&lt;/span&gt;
				&lt;span class="field-item-validation" style="display: none;"&gt;&lt;/span&gt;
			&lt;/li&gt;
			&lt;li class="field-item post-submit"&gt;
				&lt;span class="field-item-input"&gt;
					&lt;a href="#" onclick="return false;" class="internal-link add-reply submit-button" id="$core_v2_widget.UniqueId('save')"&gt;
						&lt;span&gt;&lt;/span&gt;$core_v2_language.GetResource('MediaGallery_PostComment')
					&lt;/a&gt;
					&lt;span class="processing" style="visibility: hidden;"&gt;&lt;/span&gt;
				&lt;/span&gt;
			&lt;/li&gt;
		&lt;/ul&gt;
	&lt;/fieldset&gt;
	&lt;div class="field-list-footer"&gt;&lt;/div&gt;
&lt;/div&gt;

#registerEndOfPageHtml('autoresize.jquery.min.js')
	&lt;script type="text/javascript" src="$core_v2_encoding.HtmlAttributeEncode($core_v2_widget.GetFileUrl('autoresize.jquery.min.js'))"&gt;&lt;/script&gt;
#end
#registerEndOfPageHtml('telligent.evolution.widgets.AddMediaGalleryPostComment')
	&lt;script type="text/javascript" src="$core_v2_encoding.HtmlAttributeEncode($core_v2_widget.GetFileUrl('ui.js'))"&gt;&lt;/script&gt;
#end
#registerEndOfPageHtml()
	&lt;script type="text/javascript"&gt;
	jQuery(document).ready(function(j){
		j.telligent.evolution.widgets.addMediaGalleryPostComment.register({
			wrapperId: '$core_v2_widget.WrapperElementId',
			galleryId: $gallery.Id,
			mediaId: $media.Id,
			publishErrorText: '$core_v2_encoding.JavascriptEncode($core_v2_language.GetResource('MediaGallery_CommentForm_PublishError'))',
			publishingText: '$core_v2_encoding.JavascriptEncode($core_v2_language.GetResource('MediaGallery_Posting'))',
			publishText: '$core_v2_encoding.JavascriptEncode($core_v2_language.GetResource('MediaGallery_PostComment'))',
			bodyRequiredText: '$core_v2_encoding.JavascriptEncode($core_v2_language.GetResource('Weblog_CommentForm_EnterCommentWarning'))',
			save: j('#$core_v2_widget.UniqueId('save')'),
			bodySelector: '#$core_v2_widget.UniqueId('body')',
			successMessage: j('#$core_v2_widget.UniqueId('successMessage')'),
			moderateMessage: j('#$core_v2_widget.UniqueId('moderateMessage')'),
			errorMessage: j('#$core_v2_widget.UniqueId('errorMessage')')
		});
	});
	&lt;/script&gt;
#end

			</contentScript><headerScript>
$core_v2_widget.ApplyTokens($core_v2_widget.GetStringValue('fragmentHeader', '${resource:MediaGalleries_AddMediaGalleryPostComment_Name}'))
			</headerScript><configuration>
&lt;propertyGroup id="options" resourceName="Options"&gt;
	&lt;property id="fragmentHeader" resourceName="CF_Title" dataType="string" defaultValue="${resource:MediaGalleries_AddMediaGalleryPostComment_Name}" controlType="Telligent.Evolution.Controls.ContentFragmentTokenStringControl, Telligent.Evolution.Controls" /&gt;
&lt;/propertyGroup&gt;
			</configuration><languageResources><language key="en-us"><resource name="MediaGalleries_AddMediaGalleryPostComment_Name">Media Gallery - Add Comment Form</resource><resource name="MediaGalleries_AddMediaGalleryPostComment_Description">Form for adding comments on media gallery files.</resource><resource name="Options">Options</resource><resource name="CF_Title">Widget Title</resource><resource name="CF_Comment_SuccessMessage">Your comment has been posted.</resource><resource name="Close">Close</resource><resource name="CF_Comment_ModeratedMessaage">Thank you, your comment requires moderation so it may take a while to appear.</resource><resource name="MediaGallery_LeaveComment">Leave a Comment</resource><resource name="MediaGallery_PostComment">Post</resource><resource name="MediaGallery_CommentForm_PublishError">There was an error saving your comment.</resource><resource name="MediaGallery_Posting">Publishing</resource><resource name="Weblog_CommentForm_EnterCommentWarning">Please enter a comment</resource></language></languageResources><requiredContext><context id="a91f97494d81449ca3c3ec8d6eebaf25" /></requiredContext><files><file name="autoresize.jquery.min.js">LyoNCiogalF1ZXJ5IGF1dG9SZXNpemUgKHRleHRhcmVhIGF1dG8tcmVzaXplcikNCiogQGNvcHlyaWdodCBKYW1lcyBQYWRvbHNleSBodHRwOi8vamFtZXMucGFkb2xzZXkuY29tDQoqIEB2ZXJzaW9uIDEuMDQNCiovDQoNCihmdW5jdGlvbihhKXthLmZuLmF1dG9SZXNpemU9ZnVuY3Rpb24oail7dmFyIGI9YS5leHRlbmQoe29uUmVzaXplOmZ1bmN0aW9uKCl7fSxhbmltYXRlOnRydWUsYW5pbWF0ZUR1cmF0aW9uOjE1MCxhbmltYXRlQ2FsbGJhY2s6ZnVuY3Rpb24oKXt9LGV4dHJhU3BhY2U6MjAsbGltaXQ6MTAwMH0saik7dGhpcy5maWx0ZXIoJ3RleHRhcmVhJykuZWFjaChmdW5jdGlvbigpe3ZhciBjPWEodGhpcykuY3NzKHtyZXNpemU6J25vbmUnLCdvdmVyZmxvdy15JzonaGlkZGVuJ30pLGs9Yy5oZWlnaHQoKSxmPShmdW5jdGlvbigpe3ZhciBsPVsnaGVpZ2h0Jywnd2lkdGgnLCdsaW5lSGVpZ2h0JywndGV4dERlY29yYXRpb24nLCdsZXR0ZXJTcGFjaW5nJ10saD17fTthLmVhY2gobCxmdW5jdGlvbihkLGUpe2hbZV09Yy5jc3MoZSl9KTtyZXR1cm4gYy5jbG9uZSgpLnJlbW92ZUF0dHIoJ2lkJykucmVtb3ZlQXR0cignbmFtZScpLmNzcyh7cG9zaXRpb246J2Fic29sdXRlJyx0b3A6MCxsZWZ0Oi05OTk5fSkuY3NzKGgpLmF0dHIoJ3RhYkluZGV4JywnLTEnKS5pbnNlcnRCZWZvcmUoYyl9KSgpLGk9bnVsbCxnPWZ1bmN0aW9uKCl7aWYoaz09MCl7az1jLmhlaWdodCgpO31mLmhlaWdodCgwKS52YWwoYSh0aGlzKS52YWwoKSkuc2Nyb2xsVG9wKDEwMDAwKTtmLndpZHRoKGMud2lkdGgoKSk7dmFyIGQ9TWF0aC5tYXgoZi5zY3JvbGxUb3AoKStiLmV4dHJhU3BhY2UsayksZT1hKHRoaXMpLmFkZChmKTtpZihpPT09ZCl7cmV0dXJufWk9ZDtpZihkPj1iLmxpbWl0KXthKHRoaXMpLmNzcygnb3ZlcmZsb3cteScsJycpO3JldHVybn1iLm9uUmVzaXplLmNhbGwodGhpcyk7Yi5hbmltYXRlJiZjLmNzcygnZGlzcGxheScpPT09J2Jsb2NrJz9lLnN0b3AoKS5hbmltYXRlKHtoZWlnaHQ6ZH0sYi5hbmltYXRlRHVyYXRpb24sYi5hbmltYXRlQ2FsbGJhY2spOmUuaGVpZ2h0KGQpfTtjLnVuYmluZCgnLmR5blNpeicpLmJpbmQoJ2tleXVwLmR5blNpeicsZykuYmluZCgna2V5ZG93bi5keW5TaXonLGcpLmJpbmQoJ2NoYW5nZS5keW5TaXonLGcpIH0pO3JldHVybiB0aGlzfX0pKGpRdWVyeSk7</file><file name="ui.js">KGZ1bmN0aW9uKGosIGdsb2JhbCkKewoJaWYgKHR5cGVvZiBqLnRlbGxpZ2VudCA9PT0gJ3VuZGVmaW5lZCcpCgkJai50ZWxsaWdlbnQgPSB7fTsKCglpZiAodHlwZW9mIGoudGVsbGlnZW50LmV2b2x1dGlvbiA9PT0gJ3VuZGVmaW5lZCcpCgkJai50ZWxsaWdlbnQuZXZvbHV0aW9uID0ge307CgoJaWYgKHR5cGVvZiBqLnRlbGxpZ2VudC5ldm9sdXRpb24ud2lkZ2V0cyA9PT0gJ3VuZGVmaW5lZCcpCgkJai50ZWxsaWdlbnQuZXZvbHV0aW9uLndpZGdldHMgPSB7fTsKCgl2YXIgX3NhdmUgPSBmdW5jdGlvbihjb250ZXh0KQoJewoJCWNvbnRleHQuc3VjY2Vzc01lc3NhZ2UuaGlkZSgpOwoJCWNvbnRleHQubW9kZXJhdGVNZXNzYWdlLmhpZGUoKTsKCQljb250ZXh0LmVycm9yTWVzc2FnZS5oaWRlKCk7CgkJdmFyIHcgPSBqKCcjJyArIGNvbnRleHQud3JhcHBlcklkKTsKCgkJY29udGV4dC5zYXZlCgkJCS5odG1sKCc8c3Bhbj48L3NwYW4+JyArIGNvbnRleHQucHVibGlzaGluZ1RleHQpCgkJCS5hZGRDbGFzcygnZGlzYWJsZWQnKTsKCgkJai50ZWxsaWdlbnQuZXZvbHV0aW9uLnBvc3QoewoJCQl1cmw6IGoudGVsbGlnZW50LmV2b2x1dGlvbi5zaXRlLmdldEJhc2VVcmwoKSArICdhcGkuYXNoeC92Mi9tZWRpYS97TWVkaWFHYWxsZXJ5SWR9L2ZpbGVzL3tGaWxlSWR9L2NvbW1lbnRzLmpzb24/SW5jbHVkZUZpZWxkcz1Db21tZW50LklkLENvbW1lbnQuSXNBcHByb3ZlZCcsCgkJCWRhdGE6CgkJCXsKCQkJCUJvZHk6IGooY29udGV4dC5ib2R5U2VsZWN0b3IpLnZhbCgpLAoJCQkJTWVkaWFHYWxsZXJ5SWQ6IGNvbnRleHQuZ2FsbGVyeUlkLAoJCQkJRmlsZUlkOiBjb250ZXh0Lm1lZGlhSWQKCQkJfSwKCQkJc3VjY2VzczogZnVuY3Rpb24ocmVzcG9uc2UpCgkJCXsKCQkJCWooJy5wcm9jZXNzaW5nJywgdykuY3NzKCd2aXNpYmlsaXR5JywgJ2hpZGRlbicpOwoKCQkJCWlmKHJlc3BvbnNlLkNvbW1lbnQuSXNBcHByb3ZlZCkKCQkJCXsKCQkJCQljb250ZXh0LnN1Y2Nlc3NNZXNzYWdlLnNsaWRlRG93bigpOwoJCQkJCWdsb2JhbC5zZXRUaW1lb3V0KGZ1bmN0aW9uKCkgeyBjb250ZXh0LnN1Y2Nlc3NNZXNzYWdlLmZhZGVPdXQoKS5zbGlkZVVwKCk7IH0sIDk5OTkpOwoJCQkJCWooZG9jdW1lbnQpLnRyaWdnZXIoJ3RlbGxpZ2VudF9tZWRpYWdhbGxlcmllc19jb21tZW50cG9zdGVkJywgJycpOwoJCQkJfQoJCQkJZWxzZQoJCQkJewoJCQkJCWNvbnRleHQubW9kZXJhdGVNZXNzYWdlLnNsaWRlRG93bigpOwoJCQkJCWdsb2JhbC5zZXRUaW1lb3V0KGZ1bmN0aW9uKCkgeyBjb250ZXh0Lm1vZGVyYXRlTWVzc2FnZS5mYWRlT3V0KCkuc2xpZGVVcCgpOyB9LCA5OTk5KTsKCQkJCX0KCgkJCQlqKGNvbnRleHQuYm9keVNlbGVjdG9yKS52YWwoJycpOwoJCQkJY29udGV4dC5zYXZlLmV2b2x1dGlvblZhbGlkYXRpb24oJ3Jlc2V0Jyk7CgkJCQljb250ZXh0LnNhdmUuaHRtbCgnPHNwYW4+PC9zcGFuPicgKyBjb250ZXh0LnB1Ymxpc2hUZXh0KS5yZW1vdmVDbGFzcygnZGlzYWJsZWQnKTsKCQkJfSwKCQkJZXJyb3I6IGZ1bmN0aW9uKHhociwgZGVzYywgZXgpCgkJCXsKCQkJCWooJy5wcm9jZXNzaW5nJywgdykuY3NzKCJ2aXNpYmlsaXR5IiwgImhpZGRlbiIpOwoJCQkJY29udGV4dC5zYXZlLmh0bWwoJzxzcGFuPjwvc3Bhbj4nICsgY29udGV4dC5wdWJsaXNoVGV4dCkucmVtb3ZlQ2xhc3MoJ2Rpc2FibGVkJyk7CgkJCQljb250ZXh0LmVycm9yTWVzc2FnZS5odG1sKGNvbnRleHQucHVibGlzaEVycm9yVGV4dCArICcgKCcgKyBkZXNjICsgJyknKS5zbGlkZURvd24oKTsKCQkJfQoJCX0pOwoJfTsKCglqLnRlbGxpZ2VudC5ldm9sdXRpb24ud2lkZ2V0cy5hZGRNZWRpYUdhbGxlcnlQb3N0Q29tbWVudCA9Cgl7CgkJcmVnaXN0ZXI6IGZ1bmN0aW9uKGNvbnRleHQpCgkJewoJCQlqKGNvbnRleHQuYm9keVNlbGVjdG9yKS5hdXRvUmVzaXplKHsgYW5pbWF0ZTogZmFsc2UsIGxpbWl0OiAzMDAwLCBleHRyYVNwYWNlOiAxNSB9KTsKCgkJCWlmIChkb2N1bWVudC5VUkwuaW5kZXhPZignI2FkZGNvbW1lbnQnKSA+PSAwKQoJCQkJaihjb250ZXh0LmJvZHlTZWxlY3RvcikuZm9jdXMoKTsKCgkJCWooJy5pbnRlcm5hbC1saW5rLmNsb3NlLW1lc3NhZ2UnLCBqKCcjJyArIGNvbnRleHQud3JhcHBlcklkKSkuY2xpY2soZnVuY3Rpb24oKQoJCQl7CgkJCQlqKHRoaXMpLmJsdXIoKTsKCQkJCWNvbnRleHQuc3VjY2Vzc01lc3NhZ2UuZmFkZU91dCgpLnNsaWRlVXAoKTsKCQkJCXJldHVybiBmYWxzZTsKCQkJfSk7CgoJCQljb250ZXh0LnNhdmUuZXZvbHV0aW9uVmFsaWRhdGlvbigKCQkJewoJCQkJb25WYWxpZGF0ZWQ6IGZ1bmN0aW9uKGlzVmFsaWQsIGJ1dHRvbkNsaWNrZWQsIGMpCgkJCQl7CgkJCQkJaWYgKGlzVmFsaWQpCgkJCQkJCWNvbnRleHQuc2F2ZS5yZW1vdmVDbGFzcygnZGlzYWJsZWQnKTsKCQkJCQllbHNlCgkJCQkJCWNvbnRleHQuc2F2ZS5hZGRDbGFzcygnZGlzYWJsZWQnKTsKCQkJCX0sCgkJCQlvblN1Y2Nlc3NmdWxDbGljazogZnVuY3Rpb24oZSkKCQkJCXsKCQkJCQllLnByZXZlbnREZWZhdWx0KCk7CgkJCQkJaignLnByb2Nlc3NpbmcnLCBjb250ZXh0LnNhdmUucGFyZW50KCkpLmNzcygidmlzaWJpbGl0eSIsICJ2aXNpYmxlIik7CgkJCQkJY29udGV4dC5zYXZlLmFkZENsYXNzKCdkaXNhYmxlZCcpOwoJCQkJCV9zYXZlKGNvbnRleHQpOwoJCQkJfQoJCQl9KTsKCgkJCWNvbnRleHQuc2F2ZS5ldm9sdXRpb25WYWxpZGF0aW9uKCdhZGRGaWVsZCcsY29udGV4dC5ib2R5U2VsZWN0b3IsCgkJCXsKCQkJCXJlcXVpcmVkOiB0cnVlLAoJCQkJbWF4bGVuZ3RoOiAxMDAwMDAwLAoJCQkJbWVzc2FnZXM6CgkJCQl7CgkJCQkJcmVxdWlyZWQ6IGNvbnRleHQuYm9keVJlcXVpcmVkVGV4dAoJCQkJfQoJCQl9LCAnIycgKyBjb250ZXh0LndyYXBwZXJJZCArICcgLmZpZWxkLWl0ZW0ucG9zdC1ib2R5IC5maWVsZC1pdGVtLXZhbGlkYXRpb24nLCBudWxsKTsKCQl9Cgl9Owp9KShqUXVlcnksIHdpbmRvdyk7Cg==</file></files></scriptedContentFragment></scriptedContentFragments>